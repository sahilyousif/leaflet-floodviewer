<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />

  <title>Flood Level Viewer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
  <link href="css/nouislider.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="shortcut icon" href="">



</head>
<body>

  <div id='sidebar'>

    <div id="container">

      <div class="row">
       <div class="col s12">
        <p  class="">
          Select 10 year or 100 year period from the drop-down list.
        </p>
        <p  class="">
          Use the slider bar to see how various levels of sea level rise will impact the area.
        </p>
      </div>
    </div>

    <div class="row">
      <div class="col s12">
        <div class="input-field ">
          <select>
            <!-- <option value="" disabled selected>Choose your option</option> -->
            <option value="10" selected>10 year flood</option>
            <option value="100">100 year flood</option>

          </select>
          <label>Flood Period</label>
        </div>

        <p>
          <input type="checkbox" class="filled-in" id="test5" />
          <label for="test5">30% increased rainfall</label>
        </p>

      </div>
      <div class="col s9">
        <label>Sea Level Rise</label><br>
        <div id="range-input" ></div>

      </div>
      <div class="col s3">
        <div id="slider-step-value"></div>
      </div>

    </div>

  </div>
</div>


</div>
<div id='map'></div>





<script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet-src.js"></script>
<script src="https://unpkg.com/esri-leaflet@2.0.7"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
<script src="js/wNumb.js"></script>
<script src="js/nouislider.js"></script>
<script>
$(document).ready(function() {
  $('select').material_select();

});

var slider = document.getElementById('range-input');
noUiSlider.create(slider, {
 start: 0,
 connect: 'lower',
 step: 1,
 range: {
   min: 0,
   max: 5
 }
});




var mymap = L.map('map').setView([46.966162,  -123.802774], 13);

L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
  maxZoom: 18,
  attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
  '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
  'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
  id: 'mapbox.streets'
}).addTo(mymap);

var layer = [];
var color = ['#FFF0C3','#FFDE9F','#FFBF40','#ECB240','#BE9440','#967940']
current_slider_val = 0;
var year = 10;
rain30 = false;

layer[0] = L.esri.featureLayer({
  url: "https://services7.arcgis.com/pKm55wmvxVfTe8RD/arcgis/rest/services/floodplain_yellow/FeatureServer/3",
  style: function () {
    return { color: color[0], weight: 1, opacity: 0.7, fillOpacity:1 };
  }
}).addTo(mymap);

var stepSliderValueElement = document.getElementById('slider-step-value');


// Handle Slider
slider.noUiSlider.on('update', function( values, handle ) {
  stepSliderValueElement.innerHTML = parseInt(values[handle]) + " ft";
  if (year == 10){
    delta = 3;
  } else {
    delta = 17;
  }
  if (rain30){
    delta = delta + 7;
  }

  if(parseInt(values[handle]) > current_slider_val){
    for(var i=current_slider_val+1;i<=parseInt(values[handle]);i++)
    {
      console.log("adding layer " + year + "yr. Feature Layer: " + (i+delta))
      layer[i] = L.esri.featureLayer({
        url: "https://services7.arcgis.com/pKm55wmvxVfTe8RD/arcgis/rest/services/floodplain_yellow/FeatureServer/" + (parseInt(values[handle])+delta),
        style: function () {
          return { color: color[i], weight: 1, opacity: 0.7, fillOpacity:1 };
        }
      }).addTo(mymap);
    }
  }

  if(parseInt(values[handle]) < current_slider_val){
    for(var i=current_slider_val;i>parseInt(values[handle]);i--)
    {
      console.log("removing layer " + year + "yr. Feature Layer: " + (i+delta))
      mymap.removeLayer(layer[i])
    }
  }
  current_slider_val = parseInt(values[handle])
});


// Handle Checkbox
$('input[type="checkbox"]').click(function(){
  if($(this).prop("checked") == true){
    rain30 = true;
    console.log("30% inc rain enabled")
  }
  else if($(this).prop("checked") == false){
    rain30 = false
    console.log("30% inc rain disabled")
  }
  
  slider.noUiSlider.set(0);
  mymap.removeLayer(layer[0])

  if (year == 10) {
    delta = 3;
  } else {
    delta = 17;
  }

  if (rain30){
    delta = delta + 7;
  }

  console.log("layer 0 changed to " + year + "yr. Feature Layer: " + delta)
  layer[0] = L.esri.featureLayer({
    url: "https://services7.arcgis.com/pKm55wmvxVfTe8RD/arcgis/rest/services/floodplain_yellow/FeatureServer/" + delta,
    style: function () {
      return { color: color[0], weight: 1, opacity: 0.7, fillOpacity:1 };
    }
  }).addTo(mymap);

});


// Handle Select
$('select').on('change', function() {
  slider.noUiSlider.set(0);
  year = this.value;

  mymap.removeLayer(layer[0])
  
  if (year == 10) {
    delta = 3;
  } else {
    delta = 17;
  }

  if (rain30){
    delta = delta + 7;
  }

  console.log("layer 0 changed to " + year + "yr. Feature Layer: " + delta)
  layer[0] = L.esri.featureLayer({
    url: "https://services7.arcgis.com/pKm55wmvxVfTe8RD/arcgis/rest/services/floodplain_yellow/FeatureServer/" + delta,
    style: function () {
      return { color: color[0], weight: 1, opacity: 0.7, fillOpacity:1 };
    }
  }).addTo(mymap);
})

</script>
</body>
</html>